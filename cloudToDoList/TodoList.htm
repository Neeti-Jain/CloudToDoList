
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.7/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.7/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
    <script src="index.js"></script>

    
    <link rel="stylesheet" href="main2.css">
      <script>

      var userEmail = localStorage.getItem("userEmail");

var userdatabase = firebase.database().ref('/users/' + userEmail + "/todolist/");

userdatabase.once('value').then(function(snapshot) {
var jsonobj = JSON.parse(JSON.stringify(snapshot.val()))
if(jsonobj!=null)
{
  initializeUI(jsonobj);
}


 //  var username = (snapshot.val() && snapshot.val().username) || 'Anonymous';
  //alert(JSON.stringify(snapshot.val()))
});

function initializeUI(jsonobj)
{
  

for (var listkey in jsonobj) {
    if (jsonobj.hasOwnProperty(listkey)) {
      
      //alert(listkey)

      var currentDate = new Date();
      var currentTime = currentDate.getTime();

      var listdiv = document.createElement('div');
      listdiv.id = "divi"+currentTime;
      listdiv.className  ="todolistdiv"
      listnameValue=listkey;
      var listNameLabel= document.createElement("p");
      listNameLabel.id = "p_list_name"+currentTime;
      listNameLabel.innerHTML = listnameValue;
      listdiv.appendChild(listNameLabel);
      listdiv.appendChild(document .createElement("br"));
      var taskButton = getAddTaskButton(listdiv.id, listkey)
      listdiv.appendChild(taskButton);
      
      for (var taskkey in jsonobj[listkey]) {
        if(taskkey!= 'createdDate' && taskkey!='name')
          {
                addTaskDiv(
                  taskkey,
                  listdiv, 
                  jsonobj[listkey][taskkey].taskname, 
                  jsonobj[listkey][taskkey].description);

            //alert("id="+taskkey)
            //alert("in inner ->" +  jsonobj[listkey][taskkey].taskname)
            //alert("in inner ->" +  jsonobj[listkey][taskkey].description)
          }
      }
       // console.log(listkey + " --------------------> " + jsonobj[listkey]);
    document.getElementsByTagName("body")[0].appendChild(listdiv);

    }
}
}

$(document).ready(function(){
    //$("#addlist").click(function(){
      //  $("#list").show();
    //});
    //$("#addtask").click(function(){
        //$("#task").show();
    

    //});
});
</script>
      <script type="text/javascript">
  var count=0;

function appendTask() {

  var listname=document.getElementById("listname").value;

  if(listname=='')
  {
    alert('Enter name')

  }
  else
  {

    document.getElementById("task_div").style.display = "block"
document.getElementById("taskdes").value = '';
document.getElementById("taskname").value='';
//    var txt1 = "
 //       <p>
 //         <input type=\"text\" id=\"taskname\" placeholder=\"Task Name...\">
   //       </p>"; 
 //  var txt2 = "
   //      <p>
    //        <input type=\"text\" id=\"taskdes\" placeholder=\"Description...\">
    //        </p>"; 
  // var btnsubmit = "            
    //        <button id=\"addtask\" onclick=\"addtaskDB()\">Submit</button>ubmit"; 
   
          // Create text with HTML
             // Create text with DOM
   // $("body").append(txt1, txt2, btnsubmit);     // Append new elements
}
}
function getAddTaskButton(parentdivid, listnameValue)
{
    var currentDate = new Date();
    var currentTime = currentDate.getTime();
    var taskButton = document.createElement("Button");
    taskButton.id="task"+currentTime;
    var textForButtonTask = document.createTextNode("Add New Task");
    taskButton.appendChild(textForButtonTask)
    taskButton.onclick = function() {
       if(listnameValue==''){
          alert('Enter List name');
       }
    else{
        addTaskClick(parentdivid, listnameValue)
         }
    };
    return taskButton;
}
function addTaskDiv(taskid, parentdiv, taskName, taskDescription)
{
    var taskContainer=document.createElement('div');
    taskContainer.className  ="todolistdiv"

    var nameTaskLabel = document.createTextNode('----Task Name-----');
    var nameTask = document.createTextNode(taskName);
    var descriptionLabel = document.createTextNode('----Description------');
    var descriptionValue = document.createTextNode(taskDescription);
    var buttonEdit = document.createElement("Button");
    buttonEdit.innerHTML='Edit'
    var buttonDelete = document.createElement("Button");
    buttonDelete.innerHTML='Delete'
    buttonDelete.onclick = function(){

    };


    taskContainer.appendChild(nameTaskLabel);
    taskContainer.appendChild(nameTask);
    taskContainer.appendChild(document .createElement("br"));

    taskContainer.appendChild(descriptionLabel);
    taskContainer.appendChild(descriptionValue);
    taskContainer.appendChild(document .createElement("br"));

    taskContainer.appendChild(buttonEdit);
    taskContainer.appendChild(document .createElement("br"));

    taskContainer.appendChild(buttonDelete);
    parentdiv.appendChild(taskContainer);
}
function createList(){
var currentDate = new Date();
var currentTime = currentDate.getTime();

var divElement = document.createElement('div');
divElement.id = "div"+currentTime;
divElement.className  ="todolistdiv"
var p='neeti';
//alert('divElement.id ::',divElement.id );
//alert(p)
var divCreatelistElement = document.createElement('div');

var iptNode = document.createElement("input");
iptNode.setAttribute("type", "text");
iptNode.id="list"+currentTime;

var button = document.createElement("Button");
var textForButton = document.createTextNode("Release the alert");
var listnamenode=document.createTextNode('Enter List Name');
button.appendChild(textForButton);

var createListButton = document.createElement("Button");
createListButton.id="createlist"+currentTime;
var textForcreateListButton = document.createTextNode("Create List");
createListButton.appendChild(textForcreateListButton)
var listnameValue ="new";
createListButton.onclick=function(){
    listnameValue=iptNode.value;
    var listNameLabel= document.createElement("p");
    listNameLabel.id = "p_list_name"+currentTime;
    listNameLabel.innerHTML = listnameValue;
    // Server Call
    addlistDB(listnameValue);
    divElement.appendChild(listNameLabel);
    divCreatelistElement.style.display="none";
    divElement.appendChild(document .createElement("br"));

    var taskButton = getAddTaskButton(divElement.id, listnameValue)
    divElement.appendChild(taskButton);
}


divCreatelistElement.appendChild(listnamenode);
divCreatelistElement.appendChild(iptNode);
divCreatelistElement.appendChild(createListButton );
divElement.appendChild(divCreatelistElement)

document.getElementsByTagName("body")[0].appendChild(divElement);




}

function addTaskClick(data, listnameValue){
  //alert(createList.counter);
  //++createList.counter;
count=count+1;
//alert(count);
if(count==2)
{
  //alert('more than 1 ')
  count=0
}
//alert('yahossso');

t=document.getElementById(data).lastChild.innerHTML;
//alert('div::',data);
t=document.getElementById(data);
//alert('div in funny::',t)
t=document.getElementById(data).childNodes[0].nodeValue;
//alert('task::',t);
var divElementTask = document.createElement('p');
var currentDate = new Date();
var currentTime = currentDate.getTime();


divElementTask.id = "paraID"+currentTime;


var node=document.createTextNode('Enter Task Name');
var iptNode = document.createElement("input");
iptNode.setAttribute("type", "text");

var iptNode1 = document.createElement("input");
iptNode1.setAttribute("type", "text");
var nodeDesc=document.createTextNode('  Enter Description');

var addTaskButton = document.createElement("Button");
addTaskButton.id="addtask"+currentTime;
addTaskButton.innerHTML = "Submit"
addTaskButton.onclick = function() {

    var newtaskId = addtaskDB(listnameValue,iptNode1.value,iptNode.value)
    divElementTask.style.display="none";

    addTaskDiv(newtaskId, document.getElementById(data), iptNode.value, iptNode1.value);
  }

divElementTask.appendChild(node);
divElementTask.appendChild(iptNode);
divElementTask.appendChild(nodeDesc);
divElementTask.appendChild(iptNode1);
divElementTask.appendChild(addTaskButton);


//element.insertBefore(div,child);
//document.getElementsById(data).insertBefore(divElementTask,child);
//document.getElementById("myLI").parentElement.nodeName;
document.getElementById(data).appendChild(divElementTask);


}

function addToDB(){
    var database=firebase.database();
    currentDate = new Date();
    currentTime = currentDate.getTime();
    userid = 'user_'+currentTime;
    var userobject =   firebase.database().ref('users/' + "username");
}

function addlistDB(listname)
{
    var database=firebase.database();
    currentDate = new Date();
    currentTime = currentDate.getTime();
    userid = 'user_'+currentTime;
    var userobject =   firebase.database().ref('users/' + userEmail);
    userobject.child('todolist').child(listname).set({name:listname,createdDate: currentTime});


}

function addtaskDB(listname,desc,tasknametext)
{
// var listname=document.getElementById("listname").value;
  //var desc=document.getElementById("taskdes").value;
  //var tasknametext=document.getElementById("taskname").value;

    var database=firebase.database();

    currentDate = new Date();
    currentTime = currentDate.getTime();

    userid = 'user_'+currentTime;

    var userobject =   firebase.database().ref('users/' + userEmail);

    var taskref = userobject.child('todolist').child(listname).push(
    {
      taskname : tasknametext,
      description : desc,
      createdDate : " "+currentDate
    });

    var newtaskID = taskref.key;
    //document.getElementById("task_div").style.display = "none"
    return newtaskID;
}


        
          </script>
        </head>
        <body>
          <h2>My To Do List</h2>
          <!--  <button> Create List </button>  -->
          <p>
            <button id="addlist" onclick="createList()" class="button_green">Add New List</button>
          </p>
          <div id="list"  style="display: none;">
            <p>
              <input type="text" id="listname" placeholder="List Name...">
              </p>
              <button id="addtask" onclick="appendTask()"> Add New dddTask</button>
            </div>
            <div id="task_div" style="display: none;">
              <p>
                <input type="text" id="taskname" placeholder="Task Name...">
                </p>
                <p>
                  <input type="text" id="taskdes" placeholder="Description...">
                  </p>
                  <button id="addtask" onclick="addtaskDB()">Submit</button>
                </div>
                <br/>
              </body>
            </html>